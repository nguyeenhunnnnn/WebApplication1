@model WebApplication1.Models.ViewModels.BaiDangPageViewModel

@using WebApplication1.Models

@{
    ViewData["Title"] = "Bang Tin";
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="~/css/styleNav.css">
    <link href="~/css/styleBangTin.css" rel="stylesheet" />
    <title>HUNO - Bảng Tin</title>

</head>
<body>
    <div class="container">
        <!-- Left Sidebar -->
        <div class="sidebar" style="color:auto">
            <div class="sidebar-logo">
                <img src="@Model.ThongTinNguoiDung.AvatarUrl" alt="OTIS Logo">
            </div>
            <div class="sidebar-header">@Model.ThongTinNguoiDung.HoTen</div>
            <div class="sidebar-subheader">@Model.ThongTinNguoiDung.Email</div>

            <div class="premium-btn">
                <i class="fas fa-crown"></i> Premium Package
            </div>

            <div class="sidebar-menu">
                <div class="sidebar-menu-item">Nhóm</div>
                <div class="sidebar-menu-item">Sự Kiện</div>
                <div class="sidebar-menu-item">Đang Theo Dõi</div>
                <div class="sidebar-menu-item last">Đã Lưu</div>
                <div class="view-more">Xem Thêm</div>
            </div>
        </div>


        <!-- Main Content -->
        <div class="content">
            <!-- Search Bar -->
            <div class="search-bar">
                <div class="search-input">
                    <span>@Model.ThongTinNguoiDung.HoTen</span>

                    <input type="text" placeholder="Hôm nay bạn muốn chia sẻ gì?" id="searchInput">
                   
                </div>
                <div class="search-categories">
                    <div class="search-category">
                        <i class="far fa-image"></i> Ảnh/Video
                    </div>
                    <div class="search-category active">
                        <i class="far fa-file-alt"></i> Bài viết
                    </div>
                </div>
            </div>

            @{
                var danhSachNguoiTao = Model.DanhSachBaiDang
                .GroupBy(x => x.Nguoitao)
                .Select(g => g.First()) // Lấy bài viết đầu tiên của mỗi người tạo
                .Take(3) // Giới hạn số lượng nếu muốn
                .ToList();
            }

            <!-- Post VOLIO -->
            <div class="post">
                @for (int i = 0; i < Model.DanhSachBaiDang.Count; i++)
                {
                    var item = Model.DanhSachBaiDang[i];
                    <!-- Post header with user info -->
                    <div class="post-header">
                        <div class="post-avatar">
                            <img src="@item.sfileAvata" alt="User Avatar">
                        </div>
                        <div class="post-info">
                            <div class="post-author">@item.Nguoitao</div>
                            <div class="post-time">@GetRelativeTime(item.dNgayTao)</div>
                        </div>
                        <div class="post-actions">
                            <div class="post-bookmark"><i class="far fa-bookmark"></i></div>
                            <div class="post-more">...</div>
                        </div>
                    </div>

                    <!-- Post content -->
                    <div class="post-content">
                        <div class="post-title">@item.sTieuDe</div>
                        <div class="post-description short">@item.sMoTa</div>
                        <div class="post-description full" style="display:none;">@item.sMoTa</div>
                        <div class="post-more-link">Xem thêm...</div>

                    </div>

                    @if (item.Vaitro == "giasu")
                    {
                        <!-- Post image - VOLIO logo-->
                        <div class="post-image-container volio-logo-container" style="width: 100%; height: 400px;">
                            <iframe src="@Url.Content(item.FileCVPath)" width="100%" height="100%" style="border: none;"></iframe>
                        </div>
                    }
                    <!-- Job title section -->
                    @if (item.Vaitro == "phuhuynh")
                    {
                    <div class="job-title-section">
                        <div class="job-title">@item.sTieuDe</div>
                        <form asp-action="UngTuyen" method="post">
                            <input type="hidden" name="baiDangId" value="@item.PK_iMaBaiDang" />
                        <button type="submit" class="apply-btn">Ứng tuyển</button>
                        </form>
                    </div>
                    }
                    <!-- Post footer with stats 
                    <div class="post-footer">
                    <div class="post-stats">
                    <i class="far fa-heart"></i> <span>135</span>
                    <i class="far fa-comment"></i> <span>21</span>
                    <i class="far fa-share-square"></i> <span>31</span>
                    </div>
                    </div>
                    -->
                    <!-- Post for you -->
                    @if(i==2)
                    {
                        <!-- For you section -->
                        <div class="for-you">
                            <div class="for-you-header">Dành cho bạn</div>

                            @foreach (var u in danhSachNguoiTao)
                            {
                                <div class="company-item">
                                    <div class="company-logo">
                                        <img src="@u.sfileAvata" alt="OTIS Logo">
                                    </div>
                                    <div class="company-info">
                                        <div class="company-name">@u.Nguoitao</div>
                                        <div class="company-type">@u.sMonday</div>
                                    </div>
                                    <button class="follow-btn">
                                        <i class="fas fa-plus"></i> Theo dõi
                                    </button>
                                </div>
                                }
                                <button class="view-more-btn">Xem thêm</button>
                            
                        </div>
                    }

                }
            </div>

            
          

          
          
        </div>
        
        <!-- Right Sidebar -->
        <div class="right-sidebar">
            <div class="company-suggestions">
                <div class="right-sidebar-header">Thêm vào bảng tin</div>

                <div class="company-item">
                    <div class="company-logo">
                        <img src="/api/placeholder/40/40" alt="Technical Support">
                    </div>
                    <div class="company-info">
                        <div class="company-name">Technical Support E...</div>
                        <div class="company-type">Công nghệ</div>
                    </div>
                    <button class="follow-btn">
                        <i class="fas fa-plus"></i> Theo dõi
                    </button>
                </div>

                <div class="company-item">
                    <div class="company-logo">
                        <img src="/api/placeholder/40/40" alt="Company Logo">
                    </div>
                    <div class="company-info">
                        <div class="company-name">CÔNG TY CỔ PHẦN GR...</div>
                        <div class="company-type">Công nghệ</div>
                    </div>
                    <button class="follow-btn">
                        <i class="fas fa-plus"></i> Theo dõi
                    </button>
                </div>

                <div class="company-item">
                    <div class="company-logo">
                        <img src="/api/placeholder/40/40" alt="Acgen Logo">
                    </div>
                    <div class="company-info">
                        <div class="company-name">CTTNHH Acgen</div>
                        <div class="company-type">Công nghệ</div>
                    </div>
                    <button class="follow-btn">
                        <i class="fas fa-plus"></i> Theo dõi
                    </button>
                </div>

                <div class="company-item">
                    <div class="company-logo">
                        <img src="/api/placeholder/40/40" alt="CTCP Logo">
                    </div>
                    <div class="company-info">
                        <div class="company-name">CTCP Công nghệ Di...</div>
                        <div class="company-type">Công nghệ</div>
                    </div>
                    <button class="follow-btn">
                        <i class="fas fa-plus"></i> Theo dõi
                    </button>
                </div>

                <div class="company-item">
                    <div class="company-logo">
                        <img src="/api/placeholder/40/40" alt="VINATECH Logo">
                    </div>
                    <div class="company-info">
                        <div class="company-name">CTTNHH VINATECH</div>
                        <div class="company-type">Công nghệ</div>
                    </div>
                    <button class="follow-btn">
                        <i class="fas fa-plus"></i> Theo dõi
                    </button>
                </div>

                <div class="view-more-text">Xem Thêm</div>
            </div>

            <div class="banner">
                <img src="/api/placeholder/300/200" alt="Marketing Agency">
            </div>
        </div>
    </div>

    <!-- Font Awesome for icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Simple interactions
            const followBtns = document.querySelectorAll('.follow-btn');
            followBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.innerHTML.includes('Theo dõi')) {
                        this.innerHTML = '<i class="fas fa-check"></i> Đang theo dõi';
                    } else {
                        this.innerHTML = '<i class="fas fa-plus"></i> Theo dõi';
                    }
                });
            });

        const searchInput = document.querySelector('.search-input input');
        searchInput.addEventListener('click', function() {
            var userRole = '@Model.ThongTinNguoiDung.VaiTroND'; // Lấy vai trò người dùng từ model

            // Dựa vào vai trò, chuyển hướng đến action tương ứng
            if (userRole === "phuhuynh") {
                window.location.href = '@Url.Action("DangTin", "baiDang")'; // Điều hướng cho phụ huynh
            } else if (userRole === "giasu") {
                window.location.href = '@Url.Action("CreateGS", "baiDang")'; // Điều hướng cho gia sư
            }
        });
            // Like functionality
            const likeIcons = document.querySelectorAll('.post-stats i.far.fa-heart');
            likeIcons.forEach(icon => {
                icon.addEventListener('click', function() {
                    const likeCountEl = this.nextElementSibling;
                    let likeCount = parseInt(likeCountEl.textContent);

                    if (this.classList.contains('far')) {
                        this.classList.remove('far');
                        this.classList.add('fas');
                        this.style.color = '#e41e3f';
                        likeCountEl.textContent = (likeCount + 1).toString();
                    } else {
                        this.classList.remove('fas');
                        this.classList.add('far');
                        this.style.color = '';
                        likeCountEl.textContent = (likeCount - 1).toString();
                    }
                });
            });

            // Bookmark functionality
            const bookmarkIcons = document.querySelectorAll('.post-bookmark i');
            bookmarkIcons.forEach(icon => {
                icon.addEventListener('click', function() {
                    if (this.classList.contains('far')) {
                        this.classList.remove('far');
                        this.classList.add('fas');
                        this.style.color = '#1877f2';
                    } else {
                        this.classList.remove('fas');
                        this.classList.add('far');
                        this.style.color = '';
                    }
                });
            });

            // "Xem thêm" functionality
            $('.post-more-link').click(function() {
                var $post = $(this).closest('.post-content');
                $post.find('.short').toggle();
                $post.find('.full').toggle();

                if ($(this).text() === 'Xem thêm...') {
                    $(this).text('Thu gọn');
                } else {
                    $(this).text('Xem thêm...');
                }
            });
           
        });

       
    </script>
    @functions {
        public string GetRelativeTime(DateTime postTime)
        {
            var timeDifference = DateTime.Now - postTime;

            if (timeDifference.TotalMinutes < 1)
            {
                return "Vừa xong";
            }
            else if (timeDifference.TotalMinutes < 60)
            {
                return $"{(int)timeDifference.TotalMinutes} phút trước";
            }
            else if (timeDifference.TotalDays < 1)
            {
                return $"{(int)timeDifference.TotalHours} giờ trước";
            }
            else if (timeDifference.TotalDays == 1)
            {
                return "Hôm qua";
            }
            else if (timeDifference.TotalDays < 7)
            {
                return $"{(int)timeDifference.TotalDays} ngày trước";
            }
            else
            {
                return postTime.ToString("dd/MM/yyyy");
            }
        }
    }

    
</body>
</html>
